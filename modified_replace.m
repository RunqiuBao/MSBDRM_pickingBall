syms g m1 m2 m3  L1 L2 L3 L4 L5 L6 L7 L8 L9 L10 L11 L12 L13 q1 q2 q3 q1p q2p q3p real
syms I111 I112 I113 I122 I123 I133 real
syms I211 I212 I213 I222 I223 I233 real
syms I311 I312 I313 I322 I323 I333 real
syms q1pp q2pp q3pp q1rp q2rp q3rp q1rpp q2rpp q3rpp qrp qrpp real


M =[ I133 + I211/2 + I222/2 + I311/2 + I322/2 - (I311*cos(2*q2 + 2*q3))/2 + (I322*cos(2*q2 + 2*q3))/2 + I312*sin(2*q2 + 2*q3) + (L3^2*m3)/2 + L7^2*m2 + (L8^2*m2)/2 + L9^2*m3 + (L10^2*m3)/2 + L11^2*m3 - (I211*cos(2*q2))/2 + (I222*cos(2*q2))/2 + I212*sin(2*q2) + 2*L9*L11*m3 + (L3^2*m3*cos(2*q2))/2 + (L8^2*m2*cos(2*q2))/2 + (L10^2*m3*cos(2*q2 + 2*q3))/2 + L3*L10*m3*cos(q3) + L3*L10*m3*cos(2*q2 + q3), I323*cos(q2 + q3) + I313*sin(q2 + q3) + I223*cos(q2) + I213*sin(q2) + L9*L10*m3*sin(q2 + q3) + L10*L11*m3*sin(q2 + q3) + L3*L9*m3*sin(q2) + L3*L11*m3*sin(q2) + L7*L8*m2*sin(q2), I323*cos(q2 + q3) + I313*sin(q2 + q3) + L9*L10*m3*sin(q2 + q3) + L10*L11*m3*sin(q2 + q3);
    I323*cos(q2 + q3) + I313*sin(q2 + q3) + I223*cos(q2) + I213*sin(q2) + L9*L10*m3*sin(q2 + q3) + L10*L11*m3*sin(q2 + q3) + L3*L9*m3*sin(q2) + L3*L11*m3*sin(q2) + L7*L8*m2*sin(q2),                                                                                                                m3*L3^2 + 2*m3*cos(q3)*L3*L10 + m2*L8^2 + m3*L10^2 + I233 + I333,                                                      m3*L10^2 + L3*m3*cos(q3)*L10 + I333;
    I323*cos(q2 + q3) + I313*sin(q2 + q3) + L9*L10*m3*sin(q2 + q3) + L10*L11*m3*sin(q2 + q3),                                                                                                                                              m3*L10^2 + L3*m3*cos(q3)*L10 + I333,                                                                          m3*L10^2 + I333];
M=subs(M,{'I111' 'I112' 'I113' 'I122' 'I123' 'I133'},{0.04 0.02 0.02 0.04 0.02 0.04});
M=subs(M,{'I211' 'I212' 'I213' 'I222' 'I223' 'I233'},{0.04 0.02 0.02 0.04 0.02 0.04});
M=subs(M,{'I311' 'I312' 'I313' 'I322' 'I323' 'I333'},{0.04 0.02 0.02 0.04 0.02 0.04});
M=subs(M,{'g' 'm1' 'm2' 'm3'},{9.81 1 1 1 });
M=subs(M,{'L1' 'L2' 'L4' 'L6' 'L7' 'L9' 'L3' 'L5' 'L8' 'L10' 'L11' 'L12' 'L13'},{ 0.1280 0.1639 0.0922 0.1000 0.1500 0.0100 0.6127 0.6873 0.3064 0.3437 0.0500 0.1157 0.002}); 
%Complete Centripetal and Coriolis Matrix (symbolic form)
G =[                                                    0;
 - g*m3*(L10*cos(q2 + q3) + L3*cos(q2)) - L8*g*m2*cos(q2);
                                   -L10*g*m3*cos(q2 + q3)];
 
G=subs(G,{'I111' 'I112' 'I113' 'I122' 'I123' 'I133'},{0.04 0.02 0.02 0.04 0.02 0.04});
G=subs(G,{'I211' 'I212' 'I213' 'I222' 'I223' 'I233'},{0.04 0.02 0.02 0.04 0.02 0.04});
G=subs(G,{'I311' 'I312' 'I313' 'I322' 'I323' 'I333'},{0.04 0.02 0.02 0.04 0.02 0.04});
G=subs(G,{'g' 'm1' 'm2' 'm3'},{9.81 1 1 1 });
G=subs(G,{'L1' 'L2' 'L4' 'L6' 'L7' 'L9' 'L3' 'L5' 'L8' 'L10' 'L11' 'L12' 'L13'},{ 0.1280 0.1639 0.0922 0.1000 0.1500 0.0100 0.6127 0.6873 0.3064 0.3437 0.0500 0.1157 0.002}); 
 

%Complete Gravitational Torques Vector (symbolic form)
C =[ I212*q2p*cos(2*q2) + (I211*q2p*sin(2*q2))/2 - (I222*q2p*sin(2*q2))/2 + I312*q2p*cos(2*q2 + 2*q3) + I312*q3p*cos(2*q2 + 2*q3) + (I311*q2p*sin(2*q2 + 2*q3))/2 + (I311*q3p*sin(2*q2 + 2*q3))/2 - (I322*q2p*sin(2*q2 + 2*q3))/2 - (I322*q3p*sin(2*q2 + 2*q3))/2 - (L3^2*m3*q2p*sin(2*q2))/2 - (L8^2*m2*q2p*sin(2*q2))/2 - (L10^2*m3*q2p*sin(2*q2 + 2*q3))/2 - (L10^2*m3*q3p*sin(2*q2 + 2*q3))/2 - (L3*L10*m3*q3p*sin(q3))/2 - L3*L10*m3*q2p*sin(2*q2 + q3) - (L3*L10*m3*q3p*sin(2*q2 + q3))/2, I212*q1p*cos(2*q2) + (I211*q1p*sin(2*q2))/2 - (I222*q1p*sin(2*q2))/2 + I312*q1p*cos(2*q2 + 2*q3) + (I311*q1p*sin(2*q2 + 2*q3))/2 - (I322*q1p*sin(2*q2 + 2*q3))/2 + I313*q2p*cos(q2 + q3) + I313*q3p*cos(q2 + q3) - I323*q2p*sin(q2 + q3) - I323*q3p*sin(q2 + q3) + I213*q2p*cos(q2) - I223*q2p*sin(q2) - (L3^2*m3*q1p*sin(2*q2))/2 - (L8^2*m2*q1p*sin(2*q2))/2 - (L10^2*m3*q1p*sin(2*q2 + 2*q3))/2 + L9*L10*m3*q2p*cos(q2 + q3) + L9*L10*m3*q3p*cos(q2 + q3) + L10*L11*m3*q2p*cos(q2 + q3) + L10*L11*m3*q3p*cos(q2 + q3) + L3*L9*m3*q2p*cos(q2) + L3*L11*m3*q2p*cos(q2) + L7*L8*m2*q2p*cos(q2) - L3*L10*m3*q1p*sin(2*q2 + q3), I312*q1p*cos(2*q2 + 2*q3) + (I311*q1p*sin(2*q2 + 2*q3))/2 - (I322*q1p*sin(2*q2 + 2*q3))/2 + I313*q2p*cos(q2 + q3) + I313*q3p*cos(q2 + q3) - I323*q2p*sin(q2 + q3) - I323*q3p*sin(q2 + q3) - (L10^2*m3*q1p*sin(2*q2 + 2*q3))/2 + L9*L10*m3*q2p*cos(q2 + q3) + L9*L10*m3*q3p*cos(q2 + q3) + L10*L11*m3*q2p*cos(q2 + q3) + L10*L11*m3*q3p*cos(q2 + q3) - (L3*L10*m3*q1p*sin(q3))/2 - (L3*L10*m3*q1p*sin(2*q2 + q3))/2;
                                                                                                                                                                                                                                                    (q1p*(m3*sin(2*q2)*L3^2 + 2*m3*sin(2*q2 + q3)*L3*L10 + m2*sin(2*q2)*L8^2 + m3*sin(2*q2 + 2*q3)*L10^2 - 2*I312*cos(2*q2 + 2*q3) - I311*sin(2*q2 + 2*q3) + I322*sin(2*q2 + 2*q3) - 2*I212*cos(2*q2) - I211*sin(2*q2) + I222*sin(2*q2)))/2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        -L3*L10*m3*q3p*sin(q3),                                                                                                                                                                                                                                                                                                                                                                                     -L3*L10*m3*sin(q3)*(q2p + q3p);
                                                                                                                                                                                                                                                                                                                               (q1p*(I322*sin(2*q2 + 2*q3) - I311*sin(2*q2 + 2*q3) - 2*I312*cos(2*q2 + 2*q3) + L10^2*m3*sin(2*q2 + 2*q3) + L3*L10*m3*sin(q3) + L3*L10*m3*sin(2*q2 + q3)))/2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         L3*L10*m3*q2p*sin(q3),                                                                                                                                                                                                                                                                                                                                                                                                                  0];
C=subs(C,{'I111' 'I112' 'I113' 'I122' 'I123' 'I133'},{0.04 0.02 0.02 0.04 0.02 0.04});
C=subs(C,{'I211' 'I212' 'I213' 'I222' 'I223' 'I233'},{0.04 0.02 0.02 0.04 0.02 0.04});
C=subs(C,{'I311' 'I312' 'I313' 'I322' 'I323' 'I333'},{0.04 0.02 0.02 0.04 0.02 0.04});
C=subs(C,{'g' 'm1' 'm2' 'm3'},{9.81 1 1 1 });
C=subs(C,{'L1' 'L2' 'L4' 'L6' 'L7' 'L9' 'L3' 'L5' 'L8' 'L10' 'L11' 'L12' 'L13'},{ 0.1280 0.1639 0.0922 0.1000 0.1500 0.0100 0.6127 0.6873 0.3064 0.3437 0.0500 0.1157 0.002}); 

EoMr= [ I133*q1rpp + (I211*q1rpp)/2 + (I222*q1rpp)/2 + (I311*q1rpp)/2 + (I322*q1rpp)/2 - (I211*q1rpp*cos(2*q2))/2 + (I222*q1rpp*cos(2*q2))/2 + I212*q1rpp*sin(2*q2) - (I311*q1rpp*cos(2*q2 + 2*q3))/2 + (I322*q1rpp*cos(2*q2 + 2*q3))/2 + I312*q1rpp*sin(2*q2 + 2*q3) + I323*q2rpp*cos(q2 + q3) + I323*q3rpp*cos(q2 + q3) + I313*q2rpp*sin(q2 + q3) + I313*q3rpp*sin(q2 + q3) + (L3^2*m3*q1rpp)/2 + L7^2*m2*q1rpp + (L8^2*m2*q1rpp)/2 + L9^2*m3*q1rpp + (L10^2*m3*q1rpp)/2 + L11^2*m3*q1rpp + I223*q2rpp*cos(q2) + I213*q2rpp*sin(q2) + (L3^2*m3*q1rpp*cos(2*q2))/2 + (L8^2*m2*q1rpp*cos(2*q2))/2 + I313*q2p*q2rp*cos(q2 + q3) + I313*q2p*q3rp*cos(q2 + q3) + I313*q3p*q2rp*cos(q2 + q3) + I313*q3p*q3rp*cos(q2 + q3) - I323*q2p*q2rp*sin(q2 + q3) - I323*q2p*q3rp*sin(q2 + q3) - I323*q3p*q2rp*sin(q2 + q3) - I323*q3p*q3rp*sin(q2 + q3) + (L10^2*m3*q1rpp*cos(2*q2 + 2*q3))/2 + I213*q2p*q2rp*cos(q2) - I223*q2p*q2rp*sin(q2) + I212*q1p*q2rp*cos(2*q2) + I212*q2p*q1rp*cos(2*q2) + (I211*q1p*q2rp*sin(2*q2))/2 + (I211*q2p*q1rp*sin(2*q2))/2 - (I222*q1p*q2rp*sin(2*q2))/2 - (I222*q2p*q1rp*sin(2*q2))/2 + 2*L9*L11*m3*q1rpp + I312*q1p*q2rp*cos(2*q2 + 2*q3) + I312*q2p*q1rp*cos(2*q2 + 2*q3) + I312*q1p*q3rp*cos(2*q2 + 2*q3) + I312*q3p*q1rp*cos(2*q2 + 2*q3) + (I311*q1p*q2rp*sin(2*q2 + 2*q3))/2 + (I311*q2p*q1rp*sin(2*q2 + 2*q3))/2 + (I311*q1p*q3rp*sin(2*q2 + 2*q3))/2 + (I311*q3p*q1rp*sin(2*q2 + 2*q3))/2 - (I322*q1p*q2rp*sin(2*q2 + 2*q3))/2 - (I322*q2p*q1rp*sin(2*q2 + 2*q3))/2 - (I322*q1p*q3rp*sin(2*q2 + 2*q3))/2 - (I322*q3p*q1rp*sin(2*q2 + 2*q3))/2 + L9*L10*m3*q2rpp*sin(q2 + q3) + L9*L10*m3*q3rpp*sin(q2 + q3) + L10*L11*m3*q2rpp*sin(q2 + q3) + L10*L11*m3*q3rpp*sin(q2 + q3) - (L3^2*m3*q1p*q2rp*sin(2*q2))/2 - (L3^2*m3*q2p*q1rp*sin(2*q2))/2 - (L8^2*m2*q1p*q2rp*sin(2*q2))/2 - (L8^2*m2*q2p*q1rp*sin(2*q2))/2 + L3*L10*m3*q1rpp*cos(q3) + L3*L9*m3*q2rpp*sin(q2) + L3*L11*m3*q2rpp*sin(q2) + L7*L8*m2*q2rpp*sin(q2) - (L10^2*m3*q1p*q2rp*sin(2*q2 + 2*q3))/2 - (L10^2*m3*q2p*q1rp*sin(2*q2 + 2*q3))/2 - (L10^2*m3*q1p*q3rp*sin(2*q2 + 2*q3))/2 - (L10^2*m3*q3p*q1rp*sin(2*q2 + 2*q3))/2 + L3*L10*m3*q1rpp*cos(2*q2 + q3) + L3*L9*m3*q2p*q2rp*cos(q2) + L3*L11*m3*q2p*q2rp*cos(q2) + L7*L8*m2*q2p*q2rp*cos(q2) - (L3*L10*m3*q1p*q3rp*sin(q3))/2 - (L3*L10*m3*q3p*q1rp*sin(q3))/2 - L3*L10*m3*q1p*q2rp*sin(2*q2 + q3) - L3*L10*m3*q2p*q1rp*sin(2*q2 + q3) - (L3*L10*m3*q1p*q3rp*sin(2*q2 + q3))/2 - (L3*L10*m3*q3p*q1rp*sin(2*q2 + q3))/2 + L9*L10*m3*q2p*q2rp*cos(q2 + q3) + L9*L10*m3*q2p*q3rp*cos(q2 + q3) + L9*L10*m3*q3p*q2rp*cos(q2 + q3) + L9*L10*m3*q3p*q3rp*cos(q2 + q3) + L10*L11*m3*q2p*q2rp*cos(q2 + q3) + L10*L11*m3*q2p*q3rp*cos(q2 + q3) + L10*L11*m3*q3p*q2rp*cos(q2 + q3) + L10*L11*m3*q3p*q3rp*cos(q2 + q3);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            I233*q2rpp + I333*q2rpp + I333*q3rpp + I323*q1rpp*cos(q2 + q3) + I313*q1rpp*sin(q2 + q3) + L3^2*m3*q2rpp + L8^2*m2*q2rpp + L10^2*m3*q2rpp + L10^2*m3*q3rpp + I223*q1rpp*cos(q2) + I213*q1rpp*sin(q2) - L10*g*m3*cos(q2 + q3) - L3*g*m3*cos(q2) - L8*g*m2*cos(q2) - I212*q1p*q1rp*cos(2*q2) - (I211*q1p*q1rp*sin(2*q2))/2 + (I222*q1p*q1rp*sin(2*q2))/2 - I312*q1p*q1rp*cos(2*q2 + 2*q3) - (I311*q1p*q1rp*sin(2*q2 + 2*q3))/2 + (I322*q1p*q1rp*sin(2*q2 + 2*q3))/2 + L9*L10*m3*q1rpp*sin(q2 + q3) + L10*L11*m3*q1rpp*sin(q2 + q3) + (L3^2*m3*q1p*q1rp*sin(2*q2))/2 + (L8^2*m2*q1p*q1rp*sin(2*q2))/2 + 2*L3*L10*m3*q2rpp*cos(q3) + L3*L10*m3*q3rpp*cos(q3) + L3*L9*m3*q1rpp*sin(q2) + L3*L11*m3*q1rpp*sin(q2) + L7*L8*m2*q1rpp*sin(q2) + (L10^2*m3*q1p*q1rp*sin(2*q2 + 2*q3))/2 - L3*L10*m3*q2p*q3rp*sin(q3) - L3*L10*m3*q3p*q2rp*sin(q3) - L3*L10*m3*q3p*q3rp*sin(q3) + L3*L10*m3*q1p*q1rp*sin(2*q2 + q3);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            I333*q2rpp + I333*q3rpp + I323*q1rpp*cos(q2 + q3) + I313*q1rpp*sin(q2 + q3) + L10^2*m3*q2rpp + L10^2*m3*q3rpp - L10*g*m3*cos(q2 + q3) - I312*q1p*q1rp*cos(2*q2 + 2*q3) - (I311*q1p*q1rp*sin(2*q2 + 2*q3))/2 + (I322*q1p*q1rp*sin(2*q2 + 2*q3))/2 + L9*L10*m3*q1rpp*sin(q2 + q3) + L10*L11*m3*q1rpp*sin(q2 + q3) + L3*L10*m3*q2rpp*cos(q3) + (L10^2*m3*q1p*q1rp*sin(2*q2 + 2*q3))/2 + (L3*L10*m3*q1p*q1rp*sin(q3))/2 + L3*L10*m3*q2p*q2rp*sin(q3) + (L3*L10*m3*q1p*q1rp*sin(2*q2 + q3))/2];
 
EoMr=subs(EoMr,{'I111' 'I112' 'I113' 'I122' 'I123' 'I133'},{0.04 0.02 0.02 0.04 0.02 0.04});
EoMr=subs(EoMr,{'I211' 'I212' 'I213' 'I222' 'I223' 'I233'},{0.04 0.02 0.02 0.04 0.02 0.04});
EoMr=subs(EoMr,{'I311' 'I312' 'I313' 'I322' 'I323' 'I333'},{0.04 0.02 0.02 0.04 0.02 0.04});
EoMr=subs(EoMr,{'g' 'm1' 'm2' 'm3'},{9.81 1 1 1 });
EoMr=subs(EoMr,{'L1' 'L2' 'L4' 'L6' 'L7' 'L9' 'L3' 'L5' 'L8' 'L10' 'L11' 'L12' 'L13'},{ 0.1280 0.1639 0.0922 0.1000 0.1500 0.0100 0.6127 0.6873 0.3064 0.3437 0.0500 0.1157 0.002}); 

    
    %robot jacobian
Jef=[ cos(q1)*(L2 + L4 - L7 + L13) + L7*cos(q1) + L3*cos(q2)*sin(q1) + cos(q2)*sin(q1)*cos(q3 + atan(L12/(L5 - L12)))*(L12^2 + (L5 - L12)^2)^(1/2) - sin(q3 + atan(L12/(L5 - L12)))*sin(q1)*sin(q2)*(L12^2 + (L5 - L12)^2)^(1/2), cos(q1)*(L3*sin(q2) + sin(q2 + q3 + atan(L12/(L5 - L12)))*(L12^2 + (L5 - L12)^2)^(1/2)), sin(q2 + q3 + atan(L12/(L5 - L12)))*cos(q1)*(L12^2 + (L5 - L12)^2)^(1/2);
    sin(q1)*(L2 + L4 - L7 + L13) + L7*sin(q1) - L3*cos(q1)*cos(q2) - cos(q1)*cos(q2)*cos(q3 + atan(L12/(L5 - L12)))*(L12^2 + (L5 - L12)^2)^(1/2) + sin(q3 + atan(L12/(L5 - L12)))*cos(q1)*sin(q2)*(L12^2 + (L5 - L12)^2)^(1/2), sin(q1)*(L3*sin(q2) + sin(q2 + q3 + atan(L12/(L5 - L12)))*(L12^2 + (L5 - L12)^2)^(1/2)), sin(q2 + q3 + atan(L12/(L5 - L12)))*sin(q1)*(L12^2 + (L5 - L12)^2)^(1/2);
    0,    - cos(q2 + q3 + atan(L12/(L5 - L12)))*(L5^2 - 2*L5*L12 + 2*L12^2)^(1/2) - L3*cos(q2),        -cos(q2 + q3 + atan(L12/(L5 - L12)))*(L12^2 + (L5 - L12)^2)^(1/2);
    0,                                                                                 sin(q1),                                                                  sin(q1);
    0,                                                                                -cos(q1),                                                                 -cos(q1);
    1,                                                                                       0,                                                                        0];
Jp=[                                                                                                                                                           - q1p*(L2*sin(q1) + L4*sin(q1) + L13*sin(q1) - L3*cos(q1)*cos(q2) - cos(q1)*cos(q2)*cos(q3 + atan(L12/(L5 - L12)))*(L5^2 - 2*L5*L12 + 2*L12^2)^(1/2) + sin(q3 + atan(L12/(L5 - L12)))*cos(q1)*sin(q2)*(L5^2 - 2*L5*L12 + 2*L12^2)^(1/2)) - q2p*sin(q1)*(sin(q2 + q3 + atan(L12/(L5 - L12)))*(L5^2 - 2*L5*L12 + 2*L12^2)^(1/2) + L3*sin(q2)) - q3p*sin(q2 + q3 + atan(L12/(L5 - L12)))*sin(q1)*(L5^2 - 2*L5*L12 + 2*L12^2)^(1/2), q2p*cos(q1)*(L3*cos(q2) + cos(q2 + q3 + atan(L12/(L5 - L12)))*(L12^2 + (L5 - L12)^2)^(1/2)) - q1p*sin(q1)*(L3*sin(q2) + sin(q2 + q3 + atan(L12/(L5 - L12)))*(L12^2 + (L5 - L12)^2)^(1/2)) + q3p*cos(q2 + q3 + atan(L12/(L5 - L12)))*cos(q1)*(L12^2 + (L5 - L12)^2)^(1/2), (L12^2 + (L5 - L12)^2)^(1/2)*(q2p*cos(q2 + q3 + atan(L12/(L5 - L12)))*cos(q1) + q3p*cos(q2 + q3 + atan(L12/(L5 - L12)))*cos(q1) - q1p*sin(q2 + q3 + atan(L12/(L5 - L12)))*sin(q1));
    q3p*(sin(q3 + atan(L12/(L5 - L12)))*cos(q1)*cos(q2)*(L12^2 + (L5 - L12)^2)^(1/2) + cos(q1)*sin(q2)*cos(q3 + atan(L12/(L5 - L12)))*(L12^2 + (L5 - L12)^2)^(1/2)) + q1p*(cos(q1)*(L2 + L4 - L7 + L13) + L7*cos(q1) + L3*cos(q2)*sin(q1) + cos(q2)*sin(q1)*cos(q3 + atan(L12/(L5 - L12)))*(L12^2 + (L5 - L12)^2)^(1/2) - sin(q3 + atan(L12/(L5 - L12)))*sin(q1)*sin(q2)*(L12^2 + (L5 - L12)^2)^(1/2)) + q2p*(L3*cos(q1)*sin(q2) + sin(q3 + atan(L12/(L5 - L12)))*cos(q1)*cos(q2)*(L12^2 + (L5 - L12)^2)^(1/2) + cos(q1)*sin(q2)*cos(q3 + atan(L12/(L5 - L12)))*(L12^2 + (L5 - L12)^2)^(1/2)), q2p*sin(q1)*(L3*cos(q2) + cos(q2 + q3 + atan(L12/(L5 - L12)))*(L12^2 + (L5 - L12)^2)^(1/2)) + q1p*cos(q1)*(L3*sin(q2) + sin(q2 + q3 + atan(L12/(L5 - L12)))*(L12^2 + (L5 - L12)^2)^(1/2)) + q3p*cos(q2 + q3 + atan(L12/(L5 - L12)))*sin(q1)*(L12^2 + (L5 - L12)^2)^(1/2), (L12^2 + (L5 - L12)^2)^(1/2)*(q1p*sin(q2 + q3 + atan(L12/(L5 - L12)))*cos(q1) + q2p*cos(q2 + q3 + atan(L12/(L5 - L12)))*sin(q1) + q3p*cos(q2 + q3 + atan(L12/(L5 - L12)))*sin(q1));
    0,                                                                                                     q2p*(sin(q2 + q3 + atan(L12/(L5 - L12)))*(L5^2 - 2*L5*L12 + 2*L12^2)^(1/2) + L3*sin(q2)) + q3p*sin(q2 + q3 + atan(L12/(L5 - L12)))*(L5^2 - 2*L5*L12 + 2*L12^2)^(1/2),                                                                                                       sin(q2 + q3 + atan(L12/(L5 - L12)))*(q2p + q3p)*(L12^2 + (L5 - L12)^2)^(1/2);
    0,                                                                                                                                                                                                                                                              q1p*cos(q1),                                                                                                                                                                        q1p*cos(q1);
    0,                                                                                                                                                                                                                                                              q1p*sin(q1),                                                                                                                                                                        q1p*sin(q1);
    0,                                                                                                                                                                                                                                                                        0,                                                                                                                                                                                  0];
Jef=subs(Jef,{'I111' 'I112' 'I113' 'I122' 'I123' 'I133'},{0.04 0.02 0.02 0.04 0.02 0.04});
Jef=subs(Jef,{'I211' 'I212' 'I213' 'I222' 'I223' 'I233'},{0.04 0.02 0.02 0.04 0.02 0.04});
Jef=subs(Jef,{'I311' 'I312' 'I313' 'I322' 'I323' 'I333'},{0.04 0.02 0.02 0.04 0.02 0.04});
Jef=subs(Jef,{'g' 'm1' 'm2' 'm3'},{9.81 1 1 1 });
Jef=subs(Jef,{'L1' 'L2' 'L4' 'L6' 'L7' 'L9' 'L3' 'L5' 'L8' 'L10' 'L11' 'L12' 'L13'},{ 0.1280 0.1639 0.0922 0.1000 0.1500 0.0100 0.6127 0.6873 0.3064 0.3437 0.0500 0.1157 0.002}); 

Jp=subs(Jp,{'I111' 'I112' 'I113' 'I122' 'I123' 'I133'},{0.04 0.02 0.02 0.04 0.02 0.04});
Jp=subs(Jp,{'I211' 'I212' 'I213' 'I222' 'I223' 'I233'},{0.04 0.02 0.02 0.04 0.02 0.04});
Jp=subs(Jp,{'I311' 'I312' 'I313' 'I322' 'I323' 'I333'},{0.04 0.02 0.02 0.04 0.02 0.04});
Jp=subs(Jp,{'g' 'm1' 'm2' 'm3'},{9.81 1 1 1 });
Jp=subs(Jp,{'L1' 'L2' 'L4' 'L6' 'L7' 'L9' 'L3' 'L5' 'L8' 'L10' 'L11' 'L12' 'L13'},{ 0.1280 0.1639 0.0922 0.1000 0.1500 0.0100 0.6127 0.6873 0.3064 0.3437 0.0500 0.1157 0.002}); 

T3_0=[ cos(q2 + q3 + atan(L12/(L5 - L12)))*cos(q1), -sin(q2 + q3 + atan(L12/(L5 - L12)))*cos(q1),  sin(q1), sin(q1)*(L2 + L4 - L7 + L13) + L7*sin(q1) - L3*cos(q1)*cos(q2) - cos(q1)*cos(q2)*cos(q3 + atan(L12/(L5 - L12)))*(L12^2 + (L5 - L12)^2)^(1/2) + sin(q3 + atan(L12/(L5 - L12)))*cos(q1)*sin(q2)*(L12^2 + (L5 - L12)^2)^(1/2);
       cos(q2 + q3 + atan(L12/(L5 - L12)))*sin(q1), -sin(q2 + q3 + atan(L12/(L5 - L12)))*sin(q1), -cos(q1), sin(q3 + atan(L12/(L5 - L12)))*sin(q1)*sin(q2)*(L12^2 + (L5 - L12)^2)^(1/2) - L7*cos(q1) - L3*cos(q2)*sin(q1) - cos(q2)*sin(q1)*cos(q3 + atan(L12/(L5 - L12)))*(L12^2 + (L5 - L12)^2)^(1/2) - cos(q1)*(L2 + L4 - L7 + L13);
               sin(q2 + q3 + atan(L12/(L5 - L12))),          cos(q2 + q3 + atan(L12/(L5 - L12))),        0,                                                                                                                                         L1 - L3*sin(q2) - sin(q2 + q3 + atan(L12/(L5 - L12)))*(L12^2 + (L5 - L12)^2)^(1/2);
                                                 0,                                            0,        0,                                                                                                                                                                                                                          1];

T3_0=subs(T3_0,{'I111' 'I112' 'I113' 'I122' 'I123' 'I133'},{0.04 0.02 0.02 0.04 0.02 0.04});
T3_0=subs(T3_0,{'I211' 'I212' 'I213' 'I222' 'I223' 'I233'},{0.04 0.02 0.02 0.04 0.02 0.04});
T3_0=subs(T3_0,{'I311' 'I312' 'I313' 'I322' 'I323' 'I333'},{0.04 0.02 0.02 0.04 0.02 0.04});
T3_0=subs(T3_0,{'g' 'm1' 'm2' 'm3'},{9.81 1 1 1 });
T3_0=subs(T3_0,{'L1' 'L2' 'L4' 'L6' 'L7' 'L9' 'L3' 'L5' 'L8' 'L10' 'L11' 'L12' 'L13'},{ 0.1280 0.1639 0.0922 0.1000 0.1500 0.0100 0.6127 0.6873 0.3064 0.3437 0.0500 0.1157 0.002}); 
